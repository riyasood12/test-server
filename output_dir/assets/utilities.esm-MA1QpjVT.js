var Ct=Object.defineProperty;var _e=t=>{throw TypeError(t)};var _t=(t,e,n)=>e in t?Ct(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var a=(t,e,n)=>_t(t,typeof e!="symbol"?e+"":e,n),ce=(t,e,n)=>e.has(t)||_e("Cannot "+n);var u=(t,e,n)=>(ce(t,e,"read from private field"),n?n.call(t):e.get(t)),N=(t,e,n)=>e.has(t)?_e("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),P=(t,e,n,r)=>(ce(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),ee=(t,e,n)=>(ce(t,e,"access private method"),n);var j,Z,gt,yt,le,U,z,$,q,O,Y,I,H,D,vt,xt,Et,ue;import{s as Se}from"./chunk-LvLJmgfZ.js";import{i as de,l as te,p as T,u as St}from"./useEvent-BhXAndur.js";import{t as Rt}from"./react-Bj1aDYRI.js";import{Ur as kt,Yr as Ft,b as Nt,ei as qt,mn as Mt,ti as K,y as Pt}from"./cells-DPp5cDaO.js";import{t as Re}from"./compiler-runtime-B3qBwwSJ.js";import{t as jt}from"./get-6uJrSKbw.js";import{t as At}from"./assertNever-CBU83Y6o.js";import{t as It}from"./debounce-B3mjKxHe.js";import{t as Lt}from"./_baseSet-5Rdwpmr3.js";import{d as x,p as b}from"./hotkeys-BHHWjLlp.js";import{t as Tt}from"./invariant-CAG_dYON.js";import{S as Ut}from"./utils-YqBXNpsM.js";import{S as zt}from"./config-Q0O7_stz.js";import{a as Ot}from"./switch-dWLWbbtg.js";import{n as ke}from"./globals-BgACvYmr.js";import{t as Fe}from"./ErrorBoundary-B9Ifj8Jf.js";import{t as Dt}from"./jsx-runtime-ZmTK25f3.js";import{t as Wt}from"./button-CZ3Cs4qb.js";import{t as Ht}from"./cn-BKtXLv3a.js";import{Z as Bt}from"./JsonOutput-PE5ko4gi.js";import{t as Vt}from"./createReducer-B3rBsy4P.js";import{t as me}from"./requests-B4FYHTZl.js";import{t as Ne}from"./createLucideIcon-BCdY6lG5.js";import{t as Xt}from"./x-ZP5cObgf.js";import{a as qe,l as $t,r as Me}from"./markdown-renderer-DJy8ww5d.js";import{t as Yt}from"./DeferredRequestRegistry-CMf25YiV.js";import{t as fe}from"./Deferred-DxQeE5uh.js";import{t as Pe}from"./uuid-DXdzqzcr.js";import{t as Qt}from"./use-toast-BDYuj3zG.js";import{t as je}from"./tooltip-CMQz28hC.js";import{t as Ae}from"./mode-Bn7pdJvO.js";import{n as Gt,r as Kt,t as Jt}from"./share-ipf2hrOh.js";import{r as Zt,t as en}from"./react-resizable-panels.browser.esm-Da3ksQXL.js";import{t as Ie}from"./toggle-zVW4FXNz.js";function tn(t,e,n){return t==null?t:Lt(t,e,n)}var ne=tn,nn=Ne("crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]),rn=Ne("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);function sn(t){return{all:t||(t=new Map),on:function(e,n){var r=t.get(e);r?r.push(n):t.set(e,[n])},off:function(e,n){var r=t.get(e);r&&(n?r.splice(r.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var r=t.get(e);r&&r.slice().map(function(s){s(n)}),(r=t.get("*"))&&r.slice().map(function(s){s(e,n)})}}}var c=Se(Rt(),1),pe=(0,c.createContext)(null),an=t=>{let{controller:e}=(0,c.useContext)(pe),n=c.useRef(Symbol("fill"));return(0,c.useEffect)(()=>(e.mount({name:t.name,ref:n.current,children:t.children}),()=>{e.unmount({name:t.name,ref:n.current})}),[]),(0,c.useEffect)(()=>{e.update({name:t.name,ref:n.current,children:t.children})}),null},on=Object.defineProperty,ln=(t,e,n)=>e in t?on(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Le=(t,e,n)=>(ln(t,typeof e=="symbol"?e:e+"",n),n),Te=console,un=class{constructor(t){Le(this,"_bus"),Le(this,"_db"),this._bus=t,this.handleFillMount=this.handleFillMount.bind(this),this.handleFillUpdated=this.handleFillUpdated.bind(this),this.handleFillUnmount=this.handleFillUnmount.bind(this),this._db={byName:new Map,byFill:new Map}}mount(){this._bus.on("fill-mount",this.handleFillMount),this._bus.on("fill-updated",this.handleFillUpdated),this._bus.on("fill-unmount",this.handleFillUnmount)}unmount(){this._bus.off("fill-mount",this.handleFillMount),this._bus.off("fill-updated",this.handleFillUpdated),this._bus.off("fill-unmount",this.handleFillUnmount)}handleFillMount({fill:t}){let e=c.Children.toArray(t.children),n=t.name,r={fill:t,children:e,name:n},s=this._db.byName.get(n);s?(s.components.push(r),s.listeners.forEach(i=>i([...s.components]))):this._db.byName.set(n,{listeners:[],components:[r]}),this._db.byFill.set(t.ref,r)}handleFillUpdated({fill:t}){let e=this._db.byFill.get(t.ref),n=c.Children.toArray(t.children);if(e){e.children=n;let r=this._db.byName.get(e.name);if(r)r.listeners.forEach(s=>s([...r.components]));else throw Error("registration was expected to be defined")}else{Te.error("[handleFillUpdated] component was expected to be defined");return}}handleFillUnmount({fill:t}){let e=this._db.byFill.get(t.ref);if(!e){Te.error("[handleFillUnmount] component was expected to be defined");return}let n=e.name,r=this._db.byName.get(n);if(!r)throw Error("registration was expected to be defined");r.components=r.components.filter(s=>s!==e),this._db.byFill.delete(t.ref),r.listeners.length===0&&r.components.length===0?this._db.byName.delete(n):r.listeners.forEach(s=>s([...r.components]))}onComponentsChange(t,e){let n=this._db.byName.get(t);n?(n.listeners.push(e),e(n.components)):(this._db.byName.set(t,{listeners:[e],components:[]}),e([]))}getFillsByName(t){let e=this._db.byName.get(t);return e?e.components.map(n=>n.fill):[]}getChildrenByName(t){let e=this._db.byName.get(t);return e?e.components.map(n=>n.children).reduce((n,r)=>n.concat(r),[]):[]}removeOnComponentsChange(t,e){let n=this._db.byName.get(t);if(!n)throw Error("expected registration to be defined");let r=n.listeners;r.splice(r.indexOf(e),1)}},cn=Object.defineProperty,dn=(t,e,n)=>e in t?cn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,mn=(t,e,n)=>(dn(t,typeof e=="symbol"?e:e+"",n),n),Ue=class{constructor(){mn(this,"bus",sn())}mount(t){this.bus.emit("fill-mount",{fill:t})}unmount(t){this.bus.emit("fill-unmount",{fill:t})}update(t){this.bus.emit("fill-updated",{fill:t})}};function fn(t){let e=t||new Ue;return{controller:e,manager:new un(e.bus)}}var pn=({controller:t,children:e})=>{let[n]=c.useState(()=>{let r=fn(t);return r.manager.mount(),r});return c.useEffect(()=>()=>{n.manager.unmount()},[]),c.createElement(pe.Provider,{value:n},e)};function he(t,e){let[n,r]=(0,c.useState)([]),{manager:s}=(0,c.useContext)(pe);return(0,c.useEffect)(()=>(s.onComponentsChange(t,r),()=>{s.removeOnComponentsChange(t,r)}),[t]),n.flatMap((i,m)=>{let{children:l}=i;return l.map((h,v)=>{if(typeof h=="number"||typeof h=="string")throw Error("Only element children will work here");return c.cloneElement(h,{key:m.toString()+v.toString(),...e})})})}var ze=t=>{let e=he(t.name,t.childProps);if(typeof t.children=="function"){let n=t.children(e);if(c.isValidElement(n)||n===null)return n;throw Error("Slot rendered with function must return a valid React Element.")}return e};const hn=T(null);var{valueAtom:gn,useActions:yn}=Vt(()=>({banners:[]}),{addBanner:(t,e)=>({...t,banners:[...t.banners,{...e,id:Pe()}]}),removeBanner:(t,e)=>({...t,banners:t.banners.filter(n=>n.id!==e)}),clearBanners:t=>({...t,banners:[]})});const bn=()=>St(gn);function wn(){return yn()}const vn=new Ue,re={SIDEBAR:"sidebar",CONTEXT_AWARE_PANEL:"context-aware-panel"};var xn=class{constructor(){a(this,"subscriptions",new Map)}addSubscription(t,e){var n;this.subscriptions.has(t)||this.subscriptions.set(t,new Set),(n=this.subscriptions.get(t))==null||n.add(e)}removeSubscription(t,e){var n;(n=this.subscriptions.get(t))==null||n.delete(e)}notify(t,e){for(let n of this.subscriptions.get(t)??[])n(e)}},Oe=class Ce{constructor(e){a(this,"subscriptions",new xn);this.producer=e}static withProducerCallback(e){return new Ce(e)}static empty(){return new Ce}startProducer(){this.producer&&this.producer(e=>{this.subscriptions.notify("message",e)})}connect(){return new Promise(e=>setTimeout(e,0)).then(()=>{this.subscriptions.notify("open",new Event("open"))})}get readyState(){return WebSocket.OPEN}reconnect(e,n){this.close(),this.connect()}close(){this.subscriptions.notify("close",new Event("close"))}send(e){return this.subscriptions.notify("message",new MessageEvent("message",{data:e})),Promise.resolve()}addEventListener(e,n){this.subscriptions.addSubscription(e,n),e==="open"&&n(new Event("open")),e==="message"&&this.startProducer()}removeEventListener(e,n){this.subscriptions.removeSubscription(e,n)}},En=1e10,Cn=1e3;function se(t,e){let n=t.map(r=>`"${r}"`).join(", ");return Error(`This RPC instance cannot ${e} because the transport did not provide one or more of these methods: ${n}`)}function _n(t={}){let e={};function n(o){e=o}let r={};function s(o){var f;r.unregisterHandler&&r.unregisterHandler(),r=o,(f=r.registerHandler)==null||f.call(r,G)}let i;function m(o){if(typeof o=="function"){i=o;return}i=(f,y)=>{let d=o[f];if(d)return d(y);let g=o._;if(!g)throw Error(`The requested method has no handler: ${f}`);return g(f,y)}}let{maxRequestTime:l=Cn}=t;t.transport&&s(t.transport),t.requestHandler&&m(t.requestHandler),t._debugHooks&&n(t._debugHooks);let h=0;function v(){return h<=En?++h:h=0}let E=new Map,w=new Map;function _(o,...f){let y=f[0];return new Promise((d,g)=>{var V;if(!r.send)throw se(["send"],"make requests");let A=v(),W={type:"request",id:A,method:o,params:y};E.set(A,{resolve:d,reject:g}),l!==1/0&&w.set(A,setTimeout(()=>{w.delete(A),g(Error("RPC request timed out."))},l)),(V=e.onSend)==null||V.call(e,W),r.send(W)})}let S=new Proxy(_,{get:(o,f,y)=>f in o?Reflect.get(o,f,y):d=>_(f,d)}),R=S;function k(o,...f){var g;let y=f[0];if(!r.send)throw se(["send"],"send messages");let d={type:"message",id:o,payload:y};(g=e.onSend)==null||g.call(e,d),r.send(d)}let F=new Proxy(k,{get:(o,f,y)=>f in o?Reflect.get(o,f,y):d=>k(f,d)}),C=F,M=new Map,L=new Set;function B(o,f){var y;if(!r.registerHandler)throw se(["registerHandler"],"register message listeners");if(o==="*"){L.add(f);return}M.has(o)||M.set(o,new Set),(y=M.get(o))==null||y.add(f)}function Q(o,f){var y,d;if(o==="*"){L.delete(f);return}(y=M.get(o))==null||y.delete(f),((d=M.get(o))==null?void 0:d.size)===0&&M.delete(o)}async function G(o){var f,y;if((f=e.onReceive)==null||f.call(e,o),!("type"in o))throw Error("Message does not contain a type.");if(o.type==="request"){if(!r.send||!i)throw se(["send","requestHandler"],"handle requests");let{id:d,method:g,params:A}=o,W;try{W={type:"response",id:d,success:!0,payload:await i(g,A)}}catch(V){if(!(V instanceof Error))throw V;W={type:"response",id:d,success:!1,error:V.message}}(y=e.onSend)==null||y.call(e,W),r.send(W);return}if(o.type==="response"){let d=w.get(o.id);d!=null&&clearTimeout(d);let{resolve:g,reject:A}=E.get(o.id)??{};o.success?g==null||g(o.payload):A==null||A(Error(o.error));return}if(o.type==="message"){for(let g of L)g(o.id,o.payload);let d=M.get(o.id);if(!d)return;for(let g of d)g(o.payload);return}throw Error(`Unexpected RPC message type: ${o.type}`)}return{setTransport:s,setRequestHandler:m,request:S,requestProxy:R,send:F,sendProxy:C,addMessageListener:B,removeMessageListener:Q,proxy:{send:C,request:R},_setDebugHooks:n}}function Sn(t){return _n(t)}var De="[transport-id]";function Rn(t,e){let{transportId:n}=e;return n==null?t:{[De]:n,data:t}}function kn(t,e){let{transportId:n,filter:r}=e,s=r==null?void 0:r();if(n!=null&&s!=null)throw Error("Cannot use both `transportId` and `filter` at the same time");let i=t;if(n){if(t[De]!==n)return[!0];i=t.data}return s===!1?[!0]:[!1,i]}function Fn(t,e={}){let{transportId:n,filter:r,remotePort:s}=e,i=t,m=s??t,l;return{send(h){m.postMessage(Rn(h,{transportId:n}))},registerHandler(h){l=v=>{let E=v.data,[w,_]=kn(E,{transportId:n,filter:()=>r==null?void 0:r(v)});w||h(_)},i.addEventListener("message",l)},unregisterHandler(){l&&i.removeEventListener("message",l)}}}function Nn(t,e){return Fn(t,e)}function We(t){return Sn({transport:Nn(t,{transportId:"marimo-transport"}),maxRequestTime:2e4,_debugHooks:{onSend:e=>{x.debug("[rpc] Parent -> Worker",e)},onReceive:e=>{x.debug("[rpc] Worker -> Parent",e)}}})}const He=T("Initializing..."),qn=T(t=>{let e=t(Pt),n=Object.values(e.cellRuntime);return n.some(r=>!$t(r.output))?!0:n.every(r=>r.status==="idle")});var Be=Gt(),Ve="marimo:file",Xe=new kt(null);const Mn={saveFile(t){Xe.set(Ve,t)},readFile(){return Xe.get(Ve)}};var Pn={saveFile(t){K.setCodeForHash((0,Be.compressToEncodedURIComponent)(t))},readFile(){let t=K.getCodeFromHash()||K.getCodeFromSearchParam();return t?(0,Be.decompressFromEncodedURIComponent)(t):null}};const jn={saveFile(t){},readFile(){let t=document.querySelector("marimo-code");return t?decodeURIComponent(t.textContent||"").trim():null}};var An={saveFile(t){},readFile(){if(window.location.hostname!=="marimo.app")return null;let t=new URL("files/wasm-intro.py",document.baseURI);return fetch(t.toString()).then(e=>e.ok?e.text():null).catch(()=>null)}},In={saveFile(t){},readFile(){return["import marimo","app = marimo.App()","","@app.cell","def __():","  return","",'if __name__ == "__main__":',"  app.run()"].join(`
`)}},$e=class{constructor(t){this.stores=t}insert(t,e){this.stores.splice(t,0,e)}saveFile(t){this.stores.forEach(e=>e.saveFile(t))}readFile(){for(let t of this.stores){let e=t.readFile();if(e)return e}return null}};const ie=new $e([jn,Pn]),ge=new $e([Mn,An,In]);var Ye=class bt{constructor(){a(this,"initialized",new fe);a(this,"sendRename",async({filename:e})=>(e===null||(K.setFilename(e),await this.rpc.proxy.request.bridge({functionName:"rename_file",payload:e})),null));a(this,"sendSave",async e=>{if(!this.saveRpc)return x.warn("Save RPC not initialized"),null;await this.saveRpc.saveNotebook(e);let n=await this.readCode();return n.contents&&(ie.saveFile(n.contents),ge.saveFile(n.contents)),this.rpc.proxy.request.saveNotebook(e).catch(r=>{x.error(r)}),null});a(this,"sendCopy",async()=>{b()});a(this,"sendStdin",async e=>(await this.rpc.proxy.request.bridge({functionName:"put_input",payload:e.text}),null));a(this,"sendPdb",async()=>{b()});a(this,"sendRun",async e=>(await this.rpc.proxy.request.loadPackages(e.codes.join(`
`)),await this.putControlRequest({type:"execute-cells",...e}),null));a(this,"sendRunScratchpad",async e=>(await this.rpc.proxy.request.loadPackages(e.code),await this.putControlRequest({type:"execute-scratchpad",...e}),null));a(this,"sendInterrupt",async()=>(this.interruptBuffer!==void 0&&(this.interruptBuffer[0]=2),null));a(this,"sendShutdown",async()=>(window.close(),null));a(this,"sendFormat",async e=>await this.rpc.proxy.request.bridge({functionName:"format",payload:e}));a(this,"sendDeleteCell",async e=>(await this.putControlRequest({type:"delete-cell",...e}),null));a(this,"sendInstallMissingPackages",async e=>(this.putControlRequest({type:"install-packages",...e}),null));a(this,"sendCodeCompletionRequest",async e=>(de.get(Nt)||await this.rpc.proxy.request.bridge({functionName:"code_complete",payload:e}),null));a(this,"saveUserConfig",async e=>(await this.rpc.proxy.request.bridge({functionName:"save_user_config",payload:e}),Ot.post("/kernel/save_user_config",e,{baseUrl:"/"}).catch(n=>(x.error(n),null))));a(this,"saveAppConfig",async e=>(await this.rpc.proxy.request.bridge({functionName:"save_app_config",payload:e}),null));a(this,"saveCellConfig",async e=>(await this.putControlRequest({type:"update-cell-config",...e}),null));a(this,"sendRestart",async()=>{let e=await this.readCode();return e.contents&&(ie.saveFile(e.contents),ge.saveFile(e.contents)),Kt(),null});a(this,"readCode",async()=>this.saveRpc?{contents:await this.saveRpc.readNotebook()}:(x.warn("Save RPC not initialized"),{contents:""}));a(this,"readSnippets",async()=>await this.rpc.proxy.request.bridge({functionName:"read_snippets",payload:void 0}));a(this,"openFile",async({path:e})=>{let n=Jt({code:null,baseUrl:window.location.origin});return window.open(n,"_blank"),null});a(this,"sendListFiles",async e=>await this.rpc.proxy.request.bridge({functionName:"list_files",payload:e}));a(this,"sendSearchFiles",async e=>await this.rpc.proxy.request.bridge({functionName:"search_files",payload:e}));a(this,"sendComponentValues",async e=>(await this.putControlRequest({type:"update-ui-element",...e,token:Pe()}),null));a(this,"sendInstantiate",async e=>null);a(this,"sendFunctionRequest",async e=>(await this.putControlRequest({type:"invoke-function",...e}),null));a(this,"sendCreateFileOrFolder",async e=>await this.rpc.proxy.request.bridge({functionName:"create_file_or_directory",payload:e}));a(this,"sendDeleteFileOrFolder",async e=>await this.rpc.proxy.request.bridge({functionName:"delete_file_or_directory",payload:e}));a(this,"sendRenameFileOrFolder",async e=>await this.rpc.proxy.request.bridge({functionName:"move_file_or_directory",payload:e}));a(this,"sendUpdateFile",async e=>await this.rpc.proxy.request.bridge({functionName:"update_file",payload:e}));a(this,"sendFileDetails",async e=>await this.rpc.proxy.request.bridge({functionName:"file_details",payload:e}));a(this,"exportAsHTML",async e=>await this.rpc.proxy.request.bridge({functionName:"export_html",payload:e}));a(this,"exportAsMarkdown",async e=>await this.rpc.proxy.request.bridge({functionName:"export_markdown",payload:e}));a(this,"previewDatasetColumn",async e=>(await this.putControlRequest({type:"preview-dataset-column",...e}),null));a(this,"previewSQLTable",async e=>(await this.putControlRequest({type:"preview-sql-table",...e}),null));a(this,"previewSQLTableList",async e=>(await this.putControlRequest({type:"list-sql-tables",...e}),null));a(this,"previewDataSourceConnection",async e=>(await this.putControlRequest({type:"list-data-source-connection",...e}),null));a(this,"validateSQL",async e=>(await this.putControlRequest({type:"validate-sql",...e}),null));a(this,"sendModelValue",async e=>(await this.putControlRequest({type:"model",...e}),null));a(this,"syncCellIds",()=>Promise.resolve(null));a(this,"addPackage",async e=>this.rpc.proxy.request.addPackage(e));a(this,"removePackage",async e=>this.rpc.proxy.request.removePackage(e));a(this,"getPackageList",async()=>await this.rpc.proxy.request.listPackages());a(this,"getDependencyTree",async()=>({tree:{dependencies:[],name:"",tags:[],version:null}}));a(this,"listSecretKeys",async e=>(await this.putControlRequest({type:"list-secret-keys",...e}),null));a(this,"getUsageStats",b);a(this,"openTutorial",b);a(this,"getRecentFiles",b);a(this,"getWorkspaceFiles",b);a(this,"getRunningNotebooks",b);a(this,"shutdownSession",b);a(this,"exportAsPDF",b);a(this,"autoExportAsHTML",b);a(this,"autoExportAsMarkdown",b);a(this,"autoExportAsIPYNB",b);a(this,"updateCellOutputs",b);a(this,"writeSecret",b);a(this,"invokeAiTool",b);a(this,"clearCache",b);a(this,"getCacheInfo",b);zt()&&(this.rpc=We(new Worker(new URL(""+new URL("worker-BPV9SmHz.js",import.meta.url).href,""+import.meta.url),{type:"module",name:ke()})),this.rpc.addMessageListener("ready",()=>{this.startSession()}),this.rpc.addMessageListener("initialized",()=>{this.saveRpc=this.getSaveWorker(),this.setInterruptBuffer(),this.initialized.resolve()}),this.rpc.addMessageListener("initializingMessage",({message:e})=>{de.set(He,e)}),this.rpc.addMessageListener("initializedError",({error:e})=>{this.initialized.status==="resolved"&&(x.error(e),Qt({title:"Error initializing",description:e,variant:"danger"})),this.initialized.reject(Error(e))}),this.rpc.addMessageListener("kernelMessage",({message:e})=>{var n;(n=this.messageConsumer)==null||n.call(this,new MessageEvent("message",{data:e}))}))}static get INSTANCE(){let e="_marimo_private_PyodideBridge";return window[e]||(window[e]=new bt),window[e]}getSaveWorker(){return Ae()==="read"?(x.debug("Skipping SaveWorker in read-mode"),{readFile:b,readNotebook:b,saveNotebook:b}):We(new Worker(new URL(""+new URL("save-worker-CtJsIYIM.js",import.meta.url).href,""+import.meta.url),{type:"module",name:ke()})).proxy.request}async startSession(){let e=await ie.readFile(),n=await ge.readFile(),r=K.getFilename(),s=de.get(Ut),i={},m=new URLSearchParams(window.location.search);for(let l of m.keys()){let h=m.getAll(l);i[l]=h.length===1?h[0]:h}await this.rpc.proxy.request.startSession({queryParameters:i,code:e||n||"",filename:r,userConfig:{...s,runtime:{...s.runtime,auto_instantiate:Ae()==="read"?!0:s.runtime.auto_instantiate}}})}setInterruptBuffer(){crossOriginIsolated?(this.interruptBuffer=new Uint8Array(new SharedArrayBuffer(1)),this.rpc.proxy.request.setInterruptBuffer(this.interruptBuffer)):x.warn("Not running in a secure context; interrupts are not available.")}attachMessageConsumer(e){this.messageConsumer=e,this.rpc.proxy.send.consumerReady({})}async putControlRequest(e){await this.rpc.proxy.request.bridge({functionName:"put_control_request",payload:e})}};function Ln(){return Oe.withProducerCallback(t=>{Ye.INSTANCE.attachMessageConsumer(t)})}function ae(t){return()=>({TYPE:t,is(e){return e.type===t},create(e){return new CustomEvent(t,e)}})}const Qe=ae("marimo-value-input")(),Ge=ae("marimo-value-update")(),Ke=ae("marimo-value-ready")(),Je=ae("marimo-incoming-message")();function Tn(t,e){return Qe.create({bubbles:!0,composed:!0,detail:{value:t,element:e}})}var Ze=class wt{static get INSTANCE(){let e="_marimo_private_UIElementRegistry";return window[e]||(window[e]=new wt),window[e]}constructor(){this.entries=new Map}has(e){return this.entries.has(e)}set(e,n){this.entries.has(e)&&x.debug("UIElementRegistry overwriting entry for objectId.",e),this.entries.set(e,{objectId:e,value:n,elements:new Set})}registerInstance(e,n){let r=this.entries.get(e);r===void 0?this.entries.set(e,{objectId:e,value:qt(n,this),elements:new Set([n])}):r.elements.add(n)}removeInstance(e,n){let r=this.entries.get(e);r!=null&&r.elements.has(n)&&r.elements.delete(n)}removeElementsByCell(e){[...this.entries.keys()].filter(n=>n.startsWith(`${e}-`)).forEach(n=>{this.entries.delete(n)})}lookupValue(e){let n=this.entries.get(e);return n===void 0?void 0:n.value}broadcastMessage(e,n,r){let s=this.entries.get(e);s===void 0?x.warn("UIElementRegistry missing entry",e):s.elements.forEach(i=>{i.dispatchEvent(Je.create({bubbles:!1,composed:!0,detail:{objectId:e,message:n,buffers:r}}))})}broadcastValueUpdate(e,n,r){let s=this.entries.get(n);s===void 0?x.warn("UIElementRegistry missing entry",n):(s.value=r,s.elements.forEach(i=>{i!==e&&i.dispatchEvent(Ge.create({bubbles:!1,composed:!0,detail:{value:r,element:i}}))}),document.dispatchEvent(Ke.create({bubbles:!0,composed:!0,detail:{objectId:n}})))}};const Un=Ze.INSTANCE,zn=new Yt("function-call-result",async(t,e)=>{await me().sendFunctionRequest({functionCallId:t,...e})}),On="68px";var Dn="288px";const Wn=t=>t?/^\d+$/.test(t)?`${t}px`:t:Dn,Hn=Ft({isOpen:!0},(t,e)=>{if(!e)return t;switch(e.type){case"toggle":return{...t,isOpen:e.isOpen??t.isOpen};case"setWidth":return{...t,width:e.width};default:return t}});function ye(t,e=[]){let n=[];if(t instanceof DataView)n.push(e);else if(Array.isArray(t))for(let[r,s]of t.entries())n.push(...ye(s,[...e,r]));else if(typeof t=="object"&&t)for(let[r,s]of Object.entries(t))n.push(...ye(s,[...e,r]));return n}function Bn(t){let e=ye(t);if(e.length===0)return{state:t,buffers:[],bufferPaths:[]};let n=structuredClone(t),r=[],s=[];for(let i of e){let m=jt(t,i);if(m instanceof DataView){let l=qe(m);r.push(l),s.push(i),ne(n,i,l)}}return{state:n,buffers:r,bufferPaths:s}}function et(t){let{state:e,bufferPaths:n,buffers:r}=t;if(!n||n.length===0)return e;r&&Tt(r.length===n.length,"Buffers and buffer paths not the same length");let s=e;for(let[i,m]of n.entries()){let l=r==null?void 0:r[i];if(l==null){x.warn("[anywidget] Could not find buffer at path",m);continue}typeof l=="string"?ne(s,m,Me(l)):ne(s,m,l)}return s}var Vn=(gt=class{constructor(t=1e4){N(this,j,new Map);N(this,Z);P(this,Z,t)}get(t){let e=u(this,j).get(t);return e||(e=new fe,u(this,j).set(t,e),setTimeout(()=>{e.status==="pending"&&(e.reject(Error(`Model not found for key: ${t}`)),u(this,j).delete(t))},u(this,Z))),e.promise}set(t,e){let n=u(this,j).get(t);n||(n=new fe,u(this,j).set(t,n)),n.resolve(e)}has(t){let e=u(this,j).get(t);return e!==void 0&&e.status==="resolved"}getSync(t){let e=u(this,j).get(t);if(e&&e.status==="resolved")return e.value}delete(t){u(this,j).delete(t)}},j=new WeakMap,Z=new WeakMap,gt),tt=Symbol("marimo"),nt={invoke:async()=>{let t="anywidget.invoke not supported in marimo. Please file an issue at https://github.com/marimo-team/marimo/issues";throw x.warn(t),Error(t)}};function J(t){return t[tt]}const be=new Vn;var Xn=(yt=tt,H=class{constructor(e,n){N(this,D);N(this,le,"change");N(this,U);N(this,z);N(this,$);N(this,q,{});N(this,O,new AbortController);N(this,Y);N(this,I);a(this,yt,{updateAndEmitDiffs:e=>ee(this,D,xt).call(this,e),emitCustomMessage:(e,n)=>ee(this,D,Et).call(this,e,n),resolveWidget:async e=>{var s;if(u(this,I)&&u(this,Y)===e)return u(this,I);u(this,I)&&u(this,Y)!==e&&(u(this,O).abort(),P(this,O,new AbortController),P(this,I,void 0)),P(this,Y,e);let n=typeof e=="function"?await e():e,r=await((s=n.initialize)==null?void 0:s.call(n,{model:this,experimental:nt}));return r&&u(this,O).signal.addEventListener("abort",r),P(this,I,async(i,m)=>{var h;let l=await((h=n.render)==null?void 0:h.call(n,{model:this,el:i,experimental:nt}));l&&AbortSignal.any([m,u(this,O).signal]).addEventListener("abort",l)}),u(this,I)},destroy:()=>{u(this,O).abort()}});a(this,"widget_manager",{async get_model(e){let n=await H._modelManager.get(e);if(!n)throw Error(`Model not found with id: ${e}. This is likely because the model was not registered.`);return n}});N(this,ue,It(()=>{let e=u(this,q)[u(this,le)];if(e)for(let n of e)try{n()}catch(r){x.error("Error emitting event",r)}},0));P(this,z,e),P(this,$,n),P(this,U,new Map)}off(e,n){var r;if(!e){P(this,q,{});return}if(!n){u(this,q)[e]=new Set;return}(r=u(this,q)[e])==null||r.delete(n)}send(e,n,r){let s=(r??[]).map(i=>i instanceof ArrayBuffer?new DataView(i):new DataView(i.buffer,i.byteOffset,i.byteLength));return u(this,$).sendCustomMessage(e,s).then(()=>n==null?void 0:n())}get(e){return u(this,z)[e]}set(e,n){P(this,z,{...u(this,z),[e]:n}),u(this,U).set(e,n),ee(this,D,vt).call(this,`change:${e}`,n),u(this,ue).call(this)}save_changes(){if(u(this,U).size===0)return;let e=Object.fromEntries(u(this,U).entries());u(this,U).clear(),u(this,$).sendUpdate(e)}on(e,n){u(this,q)[e]||(u(this,q)[e]=new Set),u(this,q)[e].add(n)}},le=new WeakMap,U=new WeakMap,z=new WeakMap,$=new WeakMap,q=new WeakMap,O=new WeakMap,Y=new WeakMap,I=new WeakMap,D=new WeakSet,vt=function(e,n){if(!u(this,q)[e])return;let r=u(this,q)[e];for(let s of r)try{s(n)}catch(i){x.error("Error emitting event",i)}},xt=function(e){e!=null&&Object.keys(e).forEach(n=>{let r=n;u(this,z)[r]!==e[r]&&this.set(r,e[r])})},Et=function(e,n=[]){let r=u(this,q)["msg:custom"];if(r)for(let s of r)try{s(e.content,n)}catch(i){x.error("Error emitting event",i)}},ue=new WeakMap,a(H,"_modelManager",be),H);async function $n(t,e){let n=e.model_id,r=e.message;x.debug("AnyWidget message",r);let s=("buffers"in r?r.buffers:[]).map(Me);switch(r.method){case"open":{let{state:i,buffer_paths:m=[]}=r,l=et({state:i,bufferPaths:m,buffers:s}),h=t.getSync(n);if(h){J(h).updateAndEmitDiffs(l);return}let v=new Xn(l,{async sendUpdate(E){let{state:w,buffers:_,bufferPaths:S}=Bn(E);await me().sendModelValue({modelId:n,message:{method:"update",state:w,bufferPaths:S},buffers:_})},async sendCustomMessage(E,w){await me().sendModelValue({modelId:n,message:{method:"custom",content:E},buffers:w.map(qe)})}});t.set(n,v);return}case"custom":J(await t.get(n)).emitCustomMessage({method:"custom",content:r.content},s);return;case"close":{let i=t.getSync(n);i&&J(i).destroy(),t.delete(n);return}case"update":{let{state:i,buffer_paths:m=[]}=r,l=et({state:i,bufferPaths:m,buffers:s});J(await t.get(n)).updateAndEmitDiffs(l);return}default:At(r)}}Mt(be,"MODEL_MANAGER");const rt=T(null),Yn=T(null),st=T(!1),Qn=T(!1),it=T(!1);var Gn=Re();const at=t=>{let e=(0,Gn.c)(8),{onResize:n,startingWidth:r,minWidth:s,maxWidth:i}=t,m=(0,c.useRef)(null),l=(0,c.useRef)(null),h=(0,c.useRef)(null),v,E;e[0]!==i||e[1]!==s||e[2]!==n?(v=()=>{let R=m.current,k=l.current,F=h.current;if(!R||!k&&!F)return;let C=Number.parseInt(window.getComputedStyle(R).width,10),M=0,L=!1,B=null,Q=d=>{if(!R||!L||!B)return;let g=d.clientX-M;M=d.clientX,C=B==="left"?C-g:C+g,s&&(C=Math.max(s,C)),i&&(C=Math.min(i,C)),R.style.width=`${C}px`},G=()=>{L&&(n==null||n(C),L=!1,B=null),document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",G)},o=(d,g)=>{d.preventDefault(),L=!0,B=g,M=d.clientX,document.addEventListener("mousemove",Q),document.addEventListener("mouseup",G)},f=d=>o(d,"left"),y=d=>o(d,"right");return k&&k.addEventListener("mousedown",f),F&&F.addEventListener("mousedown",y),()=>{k&&k.removeEventListener("mousedown",f),F&&F.removeEventListener("mousedown",y),document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",G)}},E=[s,i,n],e[0]=i,e[1]=s,e[2]=n,e[3]=v,e[4]=E):(v=e[3],E=e[4]),(0,c.useEffect)(v,E);let w;e[5]===Symbol.for("react.memo_cache_sentinel")?(w={left:l,right:h},e[5]=w):w=e[5];let _=r==="contentWidth"?"var(--content-width-medium)":`${r}px`,S;return e[6]===_?S=e[7]:(S={resizableDivRef:m,handleRefs:w,style:{width:_}},e[6]=_,e[7]=S),S};function ot(t){t||window.dispatchEvent(new Event("resize"))}var lt=Re(),p=Se(Dt(),1);const Kn=()=>{let t=(0,lt.c)(16),[e,n]=te(rt),[r,s]=te(st),[i,m]=te(Qn),[l,h]=te(it),v;t[0]!==s||t[1]!==n?(v=()=>{n(null),s(!1)},t[0]=s,t[1]=n,t[2]=v):v=t[2];let E=v;if(he(re.CONTEXT_AWARE_PANEL).length===0||!e||!r)return null;let w;t[3]!==l||t[4]!==i||t[5]!==h||t[6]!==m?(w=()=>(0,p.jsxs)("div",{className:"flex flex-row items-center gap-3",children:[(0,p.jsx)(je,{content:i?"Unpin panel":"Pin panel",children:(0,p.jsx)(Ie,{size:"xs",onPressedChange:()=>m(!i),pressed:i,"aria-label":i?"Unpin panel":"Pin panel",children:i?(0,p.jsx)(rn,{className:"w-4 h-4"}):(0,p.jsx)(Bt,{className:"w-4 h-4"})})}),(0,p.jsx)(je,{content:l?(0,p.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,p.jsx)("span",{children:"Follow focused table"}),(0,p.jsx)("span",{className:"text-xs text-muted-foreground w-64",children:"The panel updates as cells that output tables are focused. Click to fix to the current cell."})]}):(0,p.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,p.jsx)("span",{children:"Focus on current table"}),(0,p.jsx)("span",{className:"text-xs text-muted-foreground w-64",children:"The panel is focused on the current table. Click to update based on which cell is focused."})]}),children:(0,p.jsx)(Ie,{size:"xs",onPressedChange:()=>h(!l),pressed:l,"aria-label":l?"Follow focused cell":"Fixed",children:(0,p.jsx)(nn,{className:Ht("w-4 h-4",l&&"text-primary")})})})]}),t[3]=l,t[4]=i,t[5]=h,t[6]=m,t[7]=w):w=t[7];let _=w,S;t[8]!==E||t[9]!==_?(S=()=>(0,p.jsxs)("div",{className:"mt-2 pb-7 mb-4 h-full overflow-auto",children:[(0,p.jsxs)("div",{className:"flex flex-row justify-between items-center mx-2",children:[_(),(0,p.jsx)(Wt,{variant:"linkDestructive",size:"icon",onClick:E,"aria-label":"Close selection panel",children:(0,p.jsx)(Xt,{className:"w-4 h-4"})})]}),(0,p.jsx)(Fe,{children:(0,p.jsx)(ze,{name:re.CONTEXT_AWARE_PANEL})})]}),t[8]=E,t[9]=_,t[10]=S):S=t[10];let R=S;if(!i){let C;return t[11]===R?C=t[12]:(C=(0,p.jsx)(Zn,{children:R()}),t[11]=R,t[12]=C),C}let k;t[13]===Symbol.for("react.memo_cache_sentinel")?(k=(0,p.jsx)(Zt,{onDragging:ot,className:"resize-handle border-border z-20 print:hidden border-l"}),t[13]=k):k=t[13];let F;return t[14]===R?F=t[15]:(F=(0,p.jsxs)(p.Fragment,{children:[k,(0,p.jsx)(en,{defaultSize:20,minSize:15,maxSize:80,children:R()})]}),t[14]=R,t[15]=F),F},Jn=t=>{let e=(0,lt.c)(2),{children:n}=t,r;return e[0]===n?r=e[1]:(r=(0,p.jsx)(Fe,{children:(0,p.jsx)(an,{name:re.CONTEXT_AWARE_PANEL,children:n})}),e[0]=n,e[1]=r),r};var Zn=({children:t})=>{let{resizableDivRef:e,handleRefs:n,style:r}=at({startingWidth:400,minWidth:300,maxWidth:1500});return(0,p.jsxs)("div",{className:"absolute z-40 right-0 h-full bg-background flex flex-row",children:[(0,p.jsx)("div",{ref:n.left,className:"w-1 h-full cursor-col-resize border-l"}),(0,p.jsx)("div",{ref:e,style:r,children:t})]})};function er(){var t=[...arguments];return(0,c.useMemo)(()=>e=>{t.forEach(n=>n(e))},t)}var ut=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0;function oe(t){let e=Object.prototype.toString.call(t);return e==="[object Window]"||e==="[object global]"}function we(t){return"nodeType"in t}function X(t){var e;return t?oe(t)?t:we(t)?((e=t.ownerDocument)==null?void 0:e.defaultView)??window:window:window}function ct(t){let{Document:e}=X(t);return t instanceof e}function dt(t){return oe(t)?!1:t instanceof X(t).HTMLElement}function mt(t){return t instanceof X(t).SVGElement}function tr(t){return t?oe(t)?t.document:we(t)?ct(t)?t:dt(t)||mt(t)?t.ownerDocument:document:document:document}var ve=ut?c.useLayoutEffect:c.useEffect;function ft(t){let e=(0,c.useRef)(t);return ve(()=>{e.current=t}),(0,c.useCallback)(function(){var n=[...arguments];return e.current==null?void 0:e.current(...n)},[])}function nr(){let t=(0,c.useRef)(null);return[(0,c.useCallback)((e,n)=>{t.current=setInterval(e,n)},[]),(0,c.useCallback)(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[])]}function rr(t,e){e===void 0&&(e=[t]);let n=(0,c.useRef)(t);return ve(()=>{n.current!==t&&(n.current=t)},e),n}function sr(t,e){let n=(0,c.useRef)();return(0,c.useMemo)(()=>{let r=t(n.current);return n.current=r,r},[...e])}function ir(t){let e=ft(t),n=(0,c.useRef)(null);return[n,(0,c.useCallback)(r=>{r!==n.current&&(e==null||e(r,n.current)),n.current=r},[])]}function ar(t){let e=(0,c.useRef)();return(0,c.useEffect)(()=>{e.current=t},[t]),e.current}var xe={};function or(t,e){return(0,c.useMemo)(()=>{if(e)return e;let n=xe[t]==null?0:xe[t]+1;return xe[t]=n,t+"-"+n},[t,e])}function pt(t){return function(e){return[...arguments].slice(1).reduce((n,r)=>{let s=Object.entries(r);for(let[i,m]of s){let l=n[i];l!=null&&(n[i]=l+t*m)}return n},{...e})}}var lr=pt(1),ur=pt(-1);function cr(t){return"clientX"in t&&"clientY"in t}function dr(t){if(!t)return!1;let{KeyboardEvent:e}=X(t.target);return e&&t instanceof e}function mr(t){if(!t)return!1;let{TouchEvent:e}=X(t.target);return e&&t instanceof e}function fr(t){if(mr(t)){if(t.touches&&t.touches.length){let{clientX:e,clientY:n}=t.touches[0];return{x:e,y:n}}else if(t.changedTouches&&t.changedTouches.length){let{clientX:e,clientY:n}=t.changedTouches[0];return{x:e,y:n}}}return cr(t)?{x:t.clientX,y:t.clientY}:null}var Ee=Object.freeze({Translate:{toString(t){if(!t)return;let{x:e,y:n}=t;return"translate3d("+(e?Math.round(e):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;let{scaleX:e,scaleY:n}=t;return"scaleX("+e+") scaleY("+n+")"}},Transform:{toString(t){if(t)return[Ee.Translate.toString(t),Ee.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:e,duration:n,easing:r}=t;return e+" "+n+"ms "+r}}}),ht="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function pr(t){return t.matches(ht)?t:t.querySelector(ht)}export{vn as $,Yn as A,Un as B,or as C,at as D,ot as E,On as F,Tn as G,Qe as H,Wn as I,ie as J,Ye as K,Hn as L,be as M,J as N,st as O,$n as P,re as Q,zn as R,ar as S,Jn as T,Ke as U,Je as V,Ge as W,He as X,qn as Y,Oe as Z,nr as _,fr as a,he as at,sr as b,ct as c,we as d,hn as et,mt as f,ft as g,er as h,pr as i,ze as it,it as j,rt as k,dt as l,ur as m,lr as n,wn as nt,tr as o,ne as ot,oe as p,Ln as q,ut as r,pn as rt,X as s,Ee as t,bn as tt,dr as u,ve as v,Kn as w,ir as x,rr as y,Ze as z};
